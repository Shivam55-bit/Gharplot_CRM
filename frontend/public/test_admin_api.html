<!DOCTYPE html>
<html>
<head>
    <title>Admin API Tester</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #d4d4d4; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007acc; color: white; border: none; }
        pre { background: #252526; padding: 15px; border-radius: 5px; overflow-x: auto; }
        input { padding: 8px; margin: 5px; width: 300px; }
        .success { color: #4ec9b0; }
        .error { color: #f48771; }
    </style>
</head>
<body>
    <h2>ðŸ”§ Admin Reminder API Tester</h2>
    
    <div>
        <input type="text" id="employeeId" placeholder="Employee ID (e.g., 674710a2e5aa5766a83c2d90)" />
        <br>
        <button onclick="getEmployee()">1. Get Employee Data</button>
        <button onclick="togglePopup(true)">2. Enable Popup</button>
        <button onclick="togglePopup(false)">3. Disable Popup</button>
        <button onclick="getAllEmployees()">4. Get All Employees</button>
    </div>
    
    <div id="output"></div>
    
    <script>
        const API_BASE = 'https://abc.bhoomitechzone.us';
        const token = localStorage.getItem('adminToken');
        const output = document.getElementById('output');
        
        function log(title, data, isError = false) {
            const color = isError ? 'error' : 'success';
            output.innerHTML += `<h3 class="${color}">${title}</h3><pre>${JSON.stringify(data, null, 2)}</pre>`;
        }
        
        async function getEmployee() {
            const employeeId = document.getElementById('employeeId').value;
            if (!employeeId) return alert('Enter Employee ID!');
            
            output.innerHTML = '';
            
            try {
                const res = await fetch(`${API_BASE}/admin/employees/${employeeId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                log('GET /admin/employees/:id', data);
                
                if (data.success && data.data) {
                    log('Current adminReminderPopupEnabled value', {
                        value: data.data.adminReminderPopupEnabled,
                        type: typeof data.data.adminReminderPopupEnabled
                    });
                }
            } catch (err) {
                log('Error', err, true);
            }
        }
        
        async function togglePopup(enable) {
            const employeeId = document.getElementById('employeeId').value;
            if (!employeeId) return alert('Enter Employee ID!');
            
            output.innerHTML = '';
            
            // Try all methods
            const methods = [
                {
                    name: 'PUT /admin/reminders/employee/:id/toggle-popup',
                    url: `${API_BASE}/admin/reminders/employee/${employeeId}/toggle-popup`,
                    method: 'PUT',
                    body: { enabled: enable }
                },
                {
                    name: 'PATCH /admin/employees/:id',
                    url: `${API_BASE}/admin/employees/${employeeId}`,
                    method: 'PATCH',
                    body: { adminReminderPopupEnabled: enable }
                },
                {
                    name: 'PUT /admin/employees/:id',
                    url: `${API_BASE}/admin/employees/${employeeId}`,
                    method: 'PUT',
                    body: { adminReminderPopupEnabled: enable }
                }
            ];
            
            for (const m of methods) {
                try {
                    const res = await fetch(m.url, {
                        method: m.method,
                        headers: {
                            'Authorization': `Bearer ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(m.body)
                    });
                    const data = await res.json();
                    log(`${m.name} (Status: ${res.status})`, data, !res.ok);
                } catch (err) {
                    log(`${m.name} ERROR`, err, true);
                }
            }
            
            // Verify after update
            setTimeout(getEmployee, 1000);
        }
        
        async function getAllEmployees() {
            output.innerHTML = '';
            
            try {
                const res = await fetch(`${API_BASE}/admin/employees`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                const data = await res.json();
                log('GET /admin/employees', data);
                
                if (data.success && data.data) {
                    const employees = Array.isArray(data.data) ? data.data : data.data.employees || [];
                    log('Employees adminReminderPopupEnabled status', 
                        employees.map(e => ({
                            id: e._id,
                            name: e.name,
                            adminPopup: e.adminReminderPopupEnabled
                        }))
                    );
                }
            } catch (err) {
                log('Error', err, true);
            }
        }
        
        if (!token) {
            alert('No admin token found! Please login first.');
        } else {
            log('Admin Token Found', { token: token.substring(0, 20) + '...' });
        }
    </script>
</body>
</html>
