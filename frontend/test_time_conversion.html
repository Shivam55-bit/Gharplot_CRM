<!DOCTYPE html>
<html>
<head>
    <title>Time Conversion Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1e1e1e; color: #00ff00; }
        .test { margin: 20px 0; padding: 15px; border: 1px solid #00ff00; }
        .error { color: #ff0000; }
        .success { color: #00ff00; }
        .warning { color: #ffaa00; }
    </style>
</head>
<body>
    <h1>üïê Time Conversion Test</h1>
    
    <div class="test">
        <h3>Test 1: Current Code (Manual ISO with UTC format)</h3>
        <p>Input: <input type="datetime-local" id="test1Input" value="2025-12-18T14:30"></p>
        <button onclick="test1()">Test Current Method</button>
        <pre id="test1Output"></pre>
    </div>

    <div class="test">
        <h3>Test 2: How Backend Stores & Service Reads</h3>
        <button onclick="test2()">Simulate Full Flow</button>
        <pre id="test2Output"></pre>
    </div>

    <div class="test">
        <h3>Test 3: Correct Method (Direct ISO)</h3>
        <p>Input: <input type="datetime-local" id="test3Input" value="2025-12-18T14:30"></p>
        <button onclick="test3()">Test Direct Method</button>
        <pre id="test3Output"></pre>
    </div>

    <script>
        function test1() {
            const input = document.getElementById('test1Input').value;
            const out = document.getElementById('test1Output');
            
            out.innerHTML = 'Input: ' + input + '\n\n';
            
            // Current code method
            const dateTimeObj = new Date(input);
            const year = dateTimeObj.getFullYear();
            const month = String(dateTimeObj.getMonth() + 1).padStart(2, '0');
            const day = String(dateTimeObj.getDate()).padStart(2, '0');
            const hours = String(dateTimeObj.getHours()).padStart(2, '0');
            const minutes = String(dateTimeObj.getMinutes()).padStart(2, '0');
            const isoString = `${year}-${month}-${day}T${hours}:${minutes}:00.000Z`;
            
            out.innerHTML += 'FRONTEND SENDS:\n';
            out.innerHTML += '  ISO String: ' + isoString + '\n\n';
            
            // Backend receives and stores
            const backendStored = new Date(isoString);
            out.innerHTML += 'BACKEND STORES:\n';
            out.innerHTML += '  new Date(isoString): ' + backendStored.toISOString() + '\n';
            out.innerHTML += '  MongoDB stored: ' + backendStored.toISOString() + '\n\n';
            
            // Service reads it
            const serviceReads = new Date(backendStored.toISOString());
            const sYear = serviceReads.getUTCFullYear();
            const sMonth = serviceReads.getUTCMonth();
            const sDay = serviceReads.getUTCDate();
            const sHours = serviceReads.getUTCHours();
            const sMinutes = serviceReads.getUTCMinutes();
            const serviceLocalTime = new Date(sYear, sMonth, sDay, sHours, sMinutes);
            
            out.innerHTML += 'SERVICE READS (extracts UTC as local):\n';
            out.innerHTML += '  Extracted: ' + sYear + '-' + (sMonth+1) + '-' + sDay + ' ' + sHours + ':' + sMinutes + '\n';
            out.innerHTML += '  Creates local date: ' + serviceLocalTime.toLocaleString() + '\n\n';
            
            out.innerHTML += 'COMPARISON:\n';
            out.innerHTML += '  Original input: ' + dateTimeObj.toLocaleString() + '\n';
            out.innerHTML += '  Service sees: ' + serviceLocalTime.toLocaleString() + '\n';
            out.innerHTML += '  MATCHES? ' + (dateTimeObj.getTime() === serviceLocalTime.getTime() ? '‚úÖ YES' : '‚ùå NO') + '\n';
        }

        function test2() {
            const out = document.getElementById('test2Output');
            const now = new Date();
            const testTime = new Date(now.getTime() + 2 * 60000); // 2 minutes from now
            
            out.innerHTML = 'TEST: Create reminder for 2 minutes from now\n\n';
            out.innerHTML += 'Current time: ' + now.toLocaleString() + '\n';
            out.innerHTML += 'Reminder time: ' + testTime.toLocaleString() + '\n\n';
            
            // Method 1: Current (wrong)
            const year1 = testTime.getFullYear();
            const month1 = String(testTime.getMonth() + 1).padStart(2, '0');
            const day1 = String(testTime.getDate()).padStart(2, '0');
            const hours1 = String(testTime.getHours()).padStart(2, '0');
            const minutes1 = String(testTime.getMinutes()).padStart(2, '0');
            const iso1 = `${year1}-${month1}-${day1}T${hours1}:${minutes1}:00.000Z`;
            
            const stored1 = new Date(iso1);
            const read1 = new Date(stored1.getUTCFullYear(), stored1.getUTCMonth(), stored1.getUTCDate(), stored1.getUTCHours(), stored1.getUTCMinutes());
            
            out.innerHTML += 'METHOD 1 (Current - Manual UTC):\n';
            out.innerHTML += '  Sent: ' + iso1 + '\n';
            out.innerHTML += '  Service reads as: ' + read1.toLocaleString() + '\n';
            out.innerHTML += '  Diff: ' + Math.floor((read1 - testTime) / 60000) + ' minutes\n';
            out.innerHTML += '  Result: ' + (Math.abs(read1 - testTime) < 60000 ? '‚úÖ CORRECT' : '‚ùå WRONG') + '\n\n';
            
            // Method 2: Direct toISOString (also wrong for different reason)
            const iso2 = testTime.toISOString();
            const stored2 = new Date(iso2);
            const read2 = new Date(stored2.getUTCFullYear(), stored2.getUTCMonth(), stored2.getUTCDate(), stored2.getUTCHours(), stored2.getUTCMinutes());
            
            out.innerHTML += 'METHOD 2 (toISOString - applies timezone):\n';
            out.innerHTML += '  Sent: ' + iso2 + '\n';
            out.innerHTML += '  Service reads as: ' + read2.toLocaleString() + '\n';
            out.innerHTML += '  Diff: ' + Math.floor((read2 - testTime) / 60000) + ' minutes\n';
            out.innerHTML += '  Result: ' + (Math.abs(read2 - testTime) < 60000 ? '‚úÖ CORRECT' : '‚ùå WRONG') + '\n\n';
        }

        function test3() {
            const input = document.getElementById('test3Input').value;
            const out = document.getElementById('test3Output');
            
            out.innerHTML = 'CORRECT METHOD:\n\n';
            
            const dateTimeObj = new Date(input);
            out.innerHTML += 'Input local time: ' + dateTimeObj.toLocaleString() + '\n\n';
            
            // Send ISO WITHOUT timezone manipulation
            const isoString = input + ':00.000Z';
            
            out.innerHTML += 'Send to backend: ' + isoString + '\n\n';
            
            // Backend stores
            const stored = new Date(isoString);
            out.innerHTML += 'Backend stores: ' + stored.toISOString() + '\n\n';
            
            // Service reads
            const serviceReads = new Date(stored.toISOString());
            const serviceLocalTime = new Date(
                serviceReads.getUTCFullYear(),
                serviceReads.getUTCMonth(),
                serviceReads.getUTCDate(),
                serviceReads.getUTCHours(),
                serviceReads.getUTCMinutes()
            );
            
            out.innerHTML += 'Service extracts and creates local time: ' + serviceLocalTime.toLocaleString() + '\n\n';
            out.innerHTML += 'MATCHES? ' + (dateTimeObj.getTime() === serviceLocalTime.getTime() ? '‚úÖ YES!' : '‚ùå NO') + '\n';
        }
    </script>
</body>
</html>
